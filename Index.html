<!DOCTYPE html>
<html lang="hi">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Eklavya Sir</title>
<style>
  :root{
    --bg:#0b1220; --bg2:#0e1730; --card:#101a34cc; --text:#e9efff; --muted:#9fb0d0;
    --accent:#00ffb2; --accent2:#6df3ff;
  }
  html,body{margin:0;height:100%;background:radial-gradient(900px 600px at 15% 10%, #1a2a52 0%, var(--bg) 45%, var(--bg2) 100%);color:var(--text);font-family:system-ui,Segoe UI,Roboto,Arial;}
  .wrap{
    min-height:100%;
    display:grid;
    place-items:center;
    justify-content:center;   /* ✅ center horizontally */
    padding:20px;
  }
  .card{
    width:min(96vw,760px);height:min(90vh,760px);
    margin:0 auto;            /* ✅ force horizontal center */
    background:linear-gradient(140deg,#ffffff0d,#00000000),var(--card);
    border:1px solid #ffffff22;border-radius:18px;backdrop-filter:blur(10px);
    box-shadow:0 12px 40px #0009,0 0 60px #00ffd51e,inset 0 0 0 1px #ffffff10;
    display:flex;flex-direction:column;overflow:hidden;perspective:1000px;transform-style:preserve-3d;
  }
  .head{display:flex;gap:12px;align-items:center;padding:14px 16px;border-bottom:1px solid #ffffff1a;background:linear-gradient(180deg,#ffffff10,#0000)}
  .logo{
    width:42px;height:42px;border-radius:12px;overflow:hidden;display:flex;align-items:center;justify-content:center;
    box-shadow:0 0 18px #6df3ff80,inset 0 0 10px #ffffff1f;
  }
  .logo img{
    width:100%;height:100%;object-fit:cover;display:block;
  }
  .title{font-weight:700}.sub{font-size:13px;color:var(--muted)}
  .msgs{flex:1;overflow:auto;padding:16px;display:flex;flex-direction:column;gap:12px}
  .msg{max-width:78%;padding:12px 14px;border-radius:14px;line-height:1.55;font-size:15px;word-wrap:break-word;white-space:pre-wrap}
  .u{align-self:flex-end;background:linear-gradient(135deg,#3a4fff,#8fcdff);color:#fff;box-shadow:0 8px 20px #3a4fff44}
  .b{align-self:flex-start;background:#0f1a33;border:1px solid #2b3f70;color:#eaf2ff;box-shadow:0 8px 18px #0006}
  .msg a{color:#7ad1ff;text-decoration:underline}
  .msg code{background:#0b1226;border:1px solid #2a3b66;padding:.15rem .33rem;border-radius:6px;font-family:ui-monospace,Consolas,monospace}
  .msg pre{background:#0b1226;border:1px solid #2a3b66;padding:10px;border-radius:10px;overflow:auto}
  .typing{align-self:flex-start;display:flex;align-items:center;gap:8px;padding:8px 10px;border:1px dashed #2a3b66;border-radius:12px;color:#9fb0d0;background:#0f1a33}
  .loader{width:22px;height:22px;border-radius:50%;border:3px solid rgba(255,255,255,.18);border-top-color:#ff3b7a;animation:spin .8s linear infinite}
  @keyframes spin{to{transform:rotate(360deg)}}
  .composer{display:flex;gap:10px;padding:14px;border-top:1px solid #ffffff1a;background:linear-gradient(180deg,#0000,#0003)}
  .input{flex:1;min-height:46px;max-height:140px;resize:none;padding:12px 14px;border-radius:12px;border:1px solid #2e4679;background:#0b152c;color:var(--text);line-height:1.5;font-size:15px;outline:none}
  .input:focus{border-color:#6df3ff}
  .send{min-width:60px;border:none;border-radius:12px;padding:0 16px;font-weight:800;color:#05101c;background:linear-gradient(135deg,var(--accent2),var(--accent));cursor:pointer;box-shadow:0 8px 22px #00ffc84a}
  .send:active{transform:translateY(1px)}
</style>
</head>
<body>
<div class="wrap">
  <div class="card">
    <div class="head">
      <div class="logo">
        <img src="https://i.postimg.cc/2Sx3bxs8/Leonardo-Phoenix-10-Create-an-image-for-the-logo-of-a-chatbot-3.jpg" alt="Eklavya Sir Logo" referrerpolicy="no-referrer" decoding="async">
      </div>
      <div>
        <div class="title">Eklavya Sir</div>
        <div class="sub">MADE BY PRINCE</div>
      </div>
    </div>
    <div id="msgs" class="msgs">
      <div class="msg b"><strong>नमस्ते!</strong> मैं <em>एकलव्य सर</em> हूँ। अपना प्रश्न लिखिए, मैं मदद करता हूँ।</div>
    </div>
    <div class="composer">
      <textarea id="inp" class="input" placeholder="ASK ANYTHING"></textarea>
      <button id="send" class="send">Send</button>
    </div>
  </div>
</div>

<script>
const API_KEY = "AIzaSyDG8T1pSBSvb16Loyn8AoDdgZPi3D9z0J4";
const MODEL = "gemini-1.5-flash";
const $msgs = document.getElementById('msgs');
const $inp  = document.getElementById('inp');
const $btn  = document.getElementById('send');
let busy = false;

function sanitize(html){
  const t = document.createElement('template'); t.innerHTML = html;
  const OK = new Set(['A','B','STRONG','EM','CODE','PRE','UL','OL','LI','BR','P','I']);
  const ATTR = { 'A': new Set(['href','target','rel']) };
  (function walk(node){
    [...node.childNodes].forEach(ch=>{
      if (ch.nodeType===1){
        const el = ch;
        if (!OK.has(el.tagName)){ el.replaceWith(document.createTextNode(el.textContent||'')); return; }
        [...el.attributes].forEach(a=>{
          if (!ATTR[el.tagName] || !ATTR[el.tagName].has(a.name)) el.removeAttribute(a.name);
          if (el.tagName==='A' && a.name==='href' && /^\s*javascript:/i.test(a.value)) el.removeAttribute('href');
        });
      } else if (ch.nodeType===8){ ch.remove(); return; }
      if (ch.childNodes && ch.childNodes.length) walk(ch);
    });
  })(t.content);
  return t.innerHTML;
}
function addMsg(html, who){
  const d = document.createElement('div'); d.className = 'msg ' + (who==='u'?'u':'b'); d.innerHTML = sanitize(html);
  $msgs.appendChild(d); $msgs.scrollTop = $msgs.scrollHeight;
}
function addTyping(){ const t=document.createElement('div'); t.id='typing'; t.className='typing'; t.innerHTML=`<span class="loader"></span> सोच रहा हूँ...`; $msgs.appendChild(t); $msgs.scrollTop=$msgs.scrollHeight; }
function rmTyping(){ const t=document.getElementById('typing'); if(t) t.remove(); }

async function callGemini(prompt){
  const url = `https://generativelanguage.googleapis.com/v1beta/models/${MODEL}:generateContent?key=${API_KEY}`;
  const sys = "You are 'Eklavya Sir', a crisp, friendly Indian education assistant. Reply in Hindi by default. You may use simple HTML (a,b,strong,em,code,pre,ul,ol,li,br,p). Do not include scripts or iframes.";
  const body = {
    contents: [
      { role: "user", parts: [{ text: sys }] },
      { role: "user", parts: [{ text: prompt }] }
    ]
  };
  const res = await fetch(url, { method:"POST", headers:{ "Content-Type":"application/json" }, body: JSON.stringify(body) });
  if(!res.ok){ throw new Error(`HTTP ${res.status}`); }
  const data = await res.json();
  const txt = data?.candidates?.[0]?.content?.parts?.[0]?.text;
  if(!txt) throw new Error("No response");
  return txt;
}

async function send(){
  if(busy) return;
  const text = ($inp.value||"").trim();
  if(!text) return;
  addMsg(text,'u'); $inp.value=''; addTyping(); busy=true;
  try{
    const reply = await callGemini(text);
    rmTyping(); addMsg(reply,'b');
  }catch(e){
    rmTyping(); addMsg(`<strong>त्रुटि:</strong> ${e.message||e}`,'b');
  }finally{ busy=false; }
}

$btn.addEventListener('click', send);
$inp.addEventListener('keydown', (e)=>{
  if(e.key==='Enter'){
    if(e.shiftKey) return; 
    e.preventDefault(); send();
  }
});
</script>
</body>
</html>
